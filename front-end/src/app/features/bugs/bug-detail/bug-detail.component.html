<app-sidebar-layout activeSection="Bug Marketplace">
    <div class="bug-detail-container">
      <!-- Back button -->
      <div class="back-link">
        <a (click)="goBack()">← Back to Bug List</a>
      </div>
      
      <!-- Error message -->
      <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
      </div>
      
      <!-- Loading indicator -->
      <app-loader 
        *ngIf="isLoading" 
        [isLoading]="isLoading" 
        message="Loading bug details..."
      ></app-loader>
      
      <div *ngIf="!isLoading && bug" class="bug-content">
        <div class="bug-header">
          <h1 class="bug-title">{{ bug.title }}</h1>
          <div class="bug-meta">
            <span class="bug-difficulty" [ngClass]="getDifficultyClass()">
              {{ bug.difficulty }}
            </span>
            <span class="bug-status" [ngClass]="getStatusClass()">
              {{ bug.status }}
            </span>
          </div>
        </div>
        
        <div class="bug-info-grid">
          <div class="info-card bug-description-card">
            <h3>Description</h3>
            <div class="description-content">
              {{ bug.description }}
            </div>
          </div>
          
          <div class="info-card bug-details-card">
            <h3>Details</h3>
            <div class="details-list">
              <div class="detail-item">
                <span class="detail-label">Reward:</span>
                <span class="detail-value reward">{{ bug.reward | currency }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Posted by:</span>
                <span class="detail-value">{{ bug.publisher?.name || 'Unknown' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Created:</span>
                <span class="detail-value">{{ bug.createdAt | dateFormat }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Updated:</span>
                <span class="detail-value">{{ bug.updatedAt | dateFormat }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Verification:</span>
                <span class="detail-value">{{ bug.verificationStatus || 'Not Verified' }}</span>
              </div>
            </div>
          </div>
          
          <div class="info-card bug-tech-card">
            <h3>Technology Stack</h3>
            <div class="tech-stack-chips">
              <div *ngIf="bug.techStacks.length === 0" class="no-tech">
                No specific technologies
              </div>
              <div 
                *ngFor="let tech of bug.techStacks" 
                class="tech-chip"
              >
                {{ tech.name }}
                <span *ngIf="tech.category" class="tech-category">({{ tech.category }})</span>
              </div>
            </div>
          </div>

          <!-- <div class="info-card solution-feedback-card" *ngIf="solutions.length > 0">
          <h3>Submitted Solutions & Feedback</h3>

          <div *ngFor="let solution of solutions" class="solution-card">
            <div class="solution-details">
              <h4>{{ solution.description }}</h4>
              <a *ngIf="solution.codeLink" [href]="solution.codeLink" target="_blank">View Code</a>
              <p>Status: {{ solution.status }}</p>
              <p>Submitted At: {{ solution.submittedAt | dateFormat }}</p>
            </div>

            <div class="feedback-section" *ngIf="solution.feedbacks?.length > 0">
              <h5>Feedbacks:</h5>
              <div *ngFor="let feedback of solution.feedbacks" class="feedback-item">
                <p><strong>Rating:</strong> {{ feedback.rating }} ⭐</p>
                <p><strong>Comment:</strong> {{ feedback.feedbackMessage }}</p>
                <p><small>By: {{ feedback.company.companyName }}</small></p>
              </div>
            </div>

            <div *ngIf="solution.feedbacks?.length === 0">
              <em>No feedback submitted yet.</em>
            </div>
          </div>
        </div> -->

          
          <div class="info-card bug-actions-card">
            <h3>Actions</h3>
            <div class="actions-container">
              <div 
                class="action-buttons-container"
              >
              @if (solutions.length != 0) {
                <app-button
                type="secondary"
                (onClicked)="openSolutions()"
                >View solutions</app-button>
              }
              @if (userRole == "DEVELOPER") {
              @if (isClaimable() && !isOwnedByCurrentUser()) {
                <app-button 

                  type="primary" 
                  (onClicked)="claimBug()"
                >
                  Claim this Bug
                </app-button>

                }
                @else if (!isClaimable() && isClaimedByYou && 
                  ["CLAIMED", "IN_PROGRESS", "SUBMITTED"].indexOf(this.bug.status) != -1
                ) {
                <app-button 
                  type="primary" 
                  (onClicked)="submitSolution()"
                >
                  Submit a solution
                </app-button>

                <app-button 
                  type="secondary" 
                  (onClicked)="unclaimBug()"
                >
                Unclaim this bug
                </app-button>


                } @else if (!isClaimable() && !isClaimedByYou){
                  <div class="action-message">This bug is claimed by someone else</div>
                }
              }
              @else {
                @if (isOwnedByCurrentUser() && solutions.length == 0) {
                <div class="action-message">
                  No solutions yet for this bug.
                </div>
                }
                @else if (!isOwnedByCurrentUser()) {
                  <div class="action-message">
                    As a company, you can create bugs but not claim them.
                  </div>
                }
              }

            </div>
            
              
              <app-loader 
                *ngIf="isClaimingBug" 
                [isLoading]="isClaimingBug" 
                message="Claiming bug..."
              ></app-loader>
              
              
              <div *ngIf="!isClaimable() && bug?.status !== 'CLAIMED'" class="action-message">
                This bug is currently {{ bug?.status.toLowerCase() }}
              </div>
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </app-sidebar-layout>